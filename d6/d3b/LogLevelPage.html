<!-- HTML header for doxygen 1.9.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=11" />
        <meta name="generator" content="Doxygen 1.9.4" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>FreeCAD: Tag based log helpers</title>
        <!--<link href="../../tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="../../dynsections.js"></script>
        <script type="text/javascript" src="../../jquery.js"></script>
        <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
        <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
        <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
        <!--<link href='//fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>-->
        <link rel="stylesheet" href="../../freecad.css">
        <script type="text/javascript" src="../../doxy-boot.js"></script>
        <link rel="shortcut icon" href="https://freecadweb.org/images/favicon.ico">
    </head>
    <body>
        <div class="wrapper">
            <ul class="navbar" role="navigation">
                <li>
                    <a href="https://freecadweb.org" title="FreeCAD">
                        <img class="logo" src="https://www.freecad.org/svg/logo-freecad.svg">
                    </a>
                </li>
                <li><a href="../../index.html" title="Index">Index</a></li>
                <li><a href="../../modules.html" title="Modules list">Modules</a></li>
                <li><a href="../../annotated.html" title="Annotated list">Classes</a></li>
            </ul>
            <div id="top" class="maincontents"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Tag based log helpers </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Simple tag based log and timing helper macros and functions.</p>
<h1><a class="anchor" id="Motivation"></a>
Motivation</h1>
<p >FreeCAD <a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a> is capable of outputting to different targets, and has some basic enable/disable control of different types of logs. There is, however, no easy way to use logging facility for various FC modules. This set of helper macros and function is aimed to provide a unified logging (and timing) interface. The interface is mainly designed for C++ code. Python code can also take some advantage of log level control interface. The developer can now leave their logging code permanently active in the source code without impact on performance, and the log can be easily turned on/off dynamically using Python console for debugging purpose, even in release build.</p>
<h1><a class="anchor" id="SampleUsage"></a>
Sample Usage</h1>
<p >A set of macros is provided to ease the usage of tag based log. All the macros are defined in &lt;Base/Console.h&gt;. At the beginning of your C++ source, you need to initialize the log level of your chosen tag using,</p>
<div class="fragment"><div class="line">FC_LOG_LEVEL_INIT(tag)</div>
</div><!-- fragment --><p >It makes sense to use the same tag in multiple files for easy log level control. Please check <a class="el" href="../../d6/d3b/LogLevelPage.html#Customization">Customization</a> if You want more than one tag inside the same source file.</p>
<p >Predefined log levels are,</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define FC_LOGLEVEL_ERR 0</span></div>
<div class="line"><span class="preprocessor">#define FC_LOGLEVEL_WARN 1</span></div>
<div class="line"><span class="preprocessor">#define FC_LOGLEVEL_MSG 2</span></div>
<div class="line"><span class="preprocessor">#define FC_LOGLEVEL_LOG 3</span></div>
<div class="line"><span class="preprocessor">#define FC_LOGLEVEL_TRACE 4</span></div>
</div><!-- fragment --><p >Bigger log level integer values have lower priorities. There is a special log level,</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define FC_LOGLEVEL_DEFAULT -1</span></div>
</div><!-- fragment --><p >Actually, any negative log level behave the same, which is for tags that are not previously configured by user. The actual log level applied is controlled by <code><a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a></code>.SetDefaultLogLevel(). Python developers/end-users can configure the default log level by calling</p>
<div class="fragment"><div class="line">FreeCAD.setLogLevel(<span class="stringliteral">&#39;Default&#39;</span>,level)</div>
<div class="line">FreeCAD.setLogLevel(<span class="stringliteral">&#39;DebugDefault&#39;</span>,level)</div>
</div><!-- fragment --><p >where <code>level</code> is either a string of value <code>Error, Warning, Message, Log, Trace</code> or an integer value. By default, on release build, the default log level is <code>FC_LOGLEVEL_MSG</code>, and on debug build, <code>FC_LOGLEVEL_LOG</code>.</p>
<p >Python code can call <code>FreeCAD.setLogLevel(tag,level)</code> to configure any other tag log levels, and <code>FreeCAD.getLogLevel(tag)</code>, which outputs only integer log level.</p>
<p >You can fine tune how the log is output by passing extra parameters to #FC_LOG_LEVEL_INIT(). All the extra parameters are boolean value, which are shown blew along with their default values.</p>
<div class="fragment"><div class="line">FC_LOG_LEVEL_INIT(tag, print_tag=<span class="keyword">true</span>, print_src=0,</div>
<div class="line">         print_time=<span class="keyword">false</span>, add_eol=<span class="keyword">true</span>, refresh=<span class="keyword">false</span>)</div>
</div><!-- fragment --><p >You can dynamically modify the log style as well, by changing these variables before the actual log output macro. See <a class="el" href="../../d6/d3b/LogLevelPage.html#Customization">Customization</a> for more details</p>
<div class="fragment"><div class="line">FC_LOG_INSTANCE.refresh = <span class="keyword">true</span>; <span class="comment">// print time for each log, default false.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// print file and line number, default 0, if set to 2 then print python</span></div>
<div class="line"><span class="comment">// source from current call frame.</span></div>
<div class="line">FC_LOG_INSTANCE.print_src = 1;</div>
<div class="line"> </div>
<div class="line">FC_LOG_INSTANCE.print_tag = <span class="keyword">false</span>; <span class="comment">// do not print tag, default true</span></div>
<div class="line">FC_LOG_INSTANCE.add_eol = <span class="keyword">false</span>; <span class="comment">// do not add eol</span></div>
<div class="line">FC_LOG_INSTANCE.refresh = <span class="keyword">true</span>; <span class="comment">// refresh GUI after each log</span></div>
</div><!-- fragment --><p >Be careful with 'refresh' option. Its current implementation calls QCoreApplication::sendPostedEvent() which may cause some unexpected behavior, especially when called inside a destructor.</p>
<p >The actual logging macros are</p>
<div class="fragment"><div class="line">FC_ERR(msg)</div>
<div class="line">FC_WARN(msg)</div>
<div class="line">FC_MSG(msg)</div>
<div class="line">FC_LOG(msg)</div>
<div class="line">FC_TRACE(msg)</div>
</div><!-- fragment --><p >The logging macros correspond to existing <a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a> output functions, and <code>FC_TRACE</code> uses <a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a>.Log(), same as <code>FC_LOG</code>. These macros checks the log level defined in <code>FC_LOG_LEVEL_INIT</code> to decide whether to print log or not. <code>msg</code> here shall be a C++ streaming expression. End of line will be automatically appended by default.</p>
<div class="fragment"><div class="line">FC_ERR(<span class="stringliteral">&quot;error: &quot;</span> &lt;&lt; code &lt;&lt; <span class="stringliteral">&quot;. exiting&quot;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="TimingHelper"></a>
Timing Helpers</h1>
<p >This set of macros is for helping C++ code to time lengthy operations. Examples:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> operation() {</div>
<div class="line">     FC_TIME_INIT(t);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">//do stuff</span></div>
<div class="line"> </div>
<div class="line">     FC_TIME_LOG(t,<span class="stringliteral">&quot;operation done.&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p >This will output in console something like,</p>
<div class="fragment"><div class="line">operation done. time: 1.12s</div>
</div><!-- fragment --><p >Every time you call <code>FC_TIME_LOG</code> it will calculate the time duration between this call and the last <code>FC_TIME_LOG</code> or <code>FC_TIME_INIT</code>. Time variable <code>t</code> will then be updated to the current time. You can also use <code>FC_TIME_MSG, FC_TIME_TRACE</code> similar to <code>FC_MSG and FC_TRACE</code>.</p>
<p >To time operation in multiple stages,</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> operation() {</div>
<div class="line">     FC_TIME_INIT2(t,t1);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">//do stage 1</span></div>
<div class="line"> </div>
<div class="line">     FC_TIME_LOG(t1,<span class="stringliteral">&quot;stage1&quot;</span>);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">//do stage 2</span></div>
<div class="line"> </div>
<div class="line">     FC_TIME_LOG(t1,<span class="stringliteral">&quot;stage2&quot;</span>);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// do other stuff</span></div>
<div class="line"> </div>
<div class="line">     FC_TIME_LOG(t,<span class="stringliteral">&quot;total&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p >Will output something like, </p><div class="fragment"><div class="line">stage1 time: 1.2s</div>
<div class="line">stage2 time: 2.3s</div>
<div class="line">total time: 4.0s</div>
</div><!-- fragment --><p >To time operation in multiple functions,</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Timing {</div>
<div class="line">     FC_DURATION_DECLARE(d1)</div>
<div class="line">     FC_DURATION_DECLARE(d1_1)</div>
<div class="line">     FC_DURATION_DECLARE(d1_2)</div>
<div class="line">     FC_DURATION_DECLARE(d2);</div>
<div class="line"> </div>
<div class="line">     Timing() {</div>
<div class="line">         FC_DURATION_INIT(d1);</div>
<div class="line">         FC_DURATION_INIT(d1_1);</div>
<div class="line">         FC_DURATION_INIT(d1_2);</div>
<div class="line">         FC_DURATION_INIT(d2);</div>
<div class="line">     }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> operation1(Timing &amp;timing) {</div>
<div class="line"> </div>
<div class="line">     FC_TIME_INIT(t);</div>
<div class="line"> </div>
<div class="line">     <span class="keywordflow">for</span>(...) {</div>
<div class="line">         FC_TIME_INIT(t1);</div>
<div class="line"> </div>
<div class="line">         <span class="comment">//do setp 1</span></div>
<div class="line"> </div>
<div class="line">         FC_DURATION_PLUS(timing.d1_1,t1);</div>
<div class="line"> </div>
<div class="line">         <span class="comment">// do step 2</span></div>
<div class="line"> </div>
<div class="line">         FC_DURATION_PLUS(timing.d1_2,t1);</div>
<div class="line">     }</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// do other stuff</span></div>
<div class="line"> </div>
<div class="line">     FC_DRUATION_PLUS(timing.d1, t);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> operation2(Timing &amp;timing) {</div>
<div class="line"> </div>
<div class="line">     FC_TIME_INIT(t);</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// do stuff</span></div>
<div class="line"> </div>
<div class="line">     FC_DRUATION_PLUS(timing.d2, t);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> operation() {</div>
<div class="line"> </div>
<div class="line">     Timing timing;</div>
<div class="line"> </div>
<div class="line">     FC_TIME_INIT(t);</div>
<div class="line"> </div>
<div class="line">     <span class="keywordflow">for</span>(...) {</div>
<div class="line">         operation1(timing);</div>
<div class="line"> </div>
<div class="line">         <span class="comment">// do other stuff</span></div>
<div class="line"> </div>
<div class="line">         operation2(timing);</div>
<div class="line">     }</div>
<div class="line"> </div>
<div class="line">     FC_DURATION_LOG(timing.d1_1,<span class="stringliteral">&quot;operation 1 step 1&quot;</span>);</div>
<div class="line">     FC_DURATION_LOG(timing.d1_2,<span class="stringliteral">&quot;operation 1 step 2&quot;</span>);</div>
<div class="line">     FC_DURATION_LOG(timing.d1,<span class="stringliteral">&quot;operation 1&quot;</span>);</div>
<div class="line">     FC_DURATION_LOG(timing.d2,<span class="stringliteral">&quot;operation 2&quot;</span>);</div>
<div class="line">     FC_TIME_LOG(t,<span class="stringliteral">&quot;operation total&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p >You can also use <code>FC_DURATION_MSG, FC_DURATION_TRACE</code> as usual.</p>
<p >If you use only macros provided here to do timing, the entire timing code can be compiled out by defining <code>FC_LOG_NO_TIMING</code> before including <code>App/Console.h</code>.</p>
<h1><a class="anchor" id="Customization"></a>
Customization</h1>
<p >Most of the logging facilities are exposed through macros. This section briefs how they are implemented under the hood in case you want customization. A new function GetLogLevel(tag) is added to <a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a> to let C++ developer query a log level for an arbitrary string tag. The function returns a pointer to an integer representing the log level. Python developer or end-user can set/get the same tag based log level using FreeCAD.setLogLevel/getLogLevel. Any change to the log level is reflected through the pointer returned by <a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a>.GetLogLevel(). What <code>FC_LOG_LEVEL_INIT(tag)</code> does is to define a class <a class="el" href="../../d8/d7a/classBase_1_1LogLevel.html" title="LogLevel helper class.">Base::LogLevel</a>, and then a file static instance of that class to store the pointer to the desired tag log level. The class and instance name is predefined. Various log macros will check that instance to query log level. If you some how want to have more than one tag inside the same source file, use the following macros to define a second instance of name <code>instance_name</code> </p>
<div class="fragment"><div class="line">_FC_LOG_LEVEL_INIT(instance_name,tag)</div>
</div><!-- fragment --><p >Then, define a second set of logging macros as</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define MY_MSG(_msg) _FC_PRINT(instance_name,FC_LOGLEVEL_MSG,Message,_msg)</span></div>
<div class="line"><span class="preprocessor">#define MY_WARN(_msg) _FC_PRINT(instance_name,FC_LOGLEVEL_WARN,Warning,_msg)</span></div>
<div class="line"><span class="preprocessor">#define MY_ERR(_msg) _FC_PRINT(instance_name,FC_LOGLEVEL_ERR,Error,_msg)</span></div>
<div class="line"><span class="preprocessor">#define MY_LOG(_msg) _FC_PRINT(instance_name,FC_LOGLEVEL_LOG,Log,_msg)</span></div>
<div class="line"><span class="preprocessor">#define MY_TRACE(_msg) _FC_PRINT(instance_name,FC_LOGLEVEL_TRACE,Log,_msg)</span></div>
</div><!-- fragment --><p >Note, replace <code>instance_name</code> with your actual desired name.</p>
<p >You can also define your own log levels the same way. Macro #_FC_PRINT(_instance,_l,_func,_msg) checks to see if the log shall proceed, where <code>_instance</code> is the static loglevel instance name (default is <code>FC_LOG_INSTANCE</code>), and <code>_l</code> is the log level constant to be checked, <code>_func</code> is the <a class="el" href="../../db/d07/namespaceBase.html#a968fb30e59145eaaa8b1da98680bd729" title="Access to the Console This method is used to gain access to the one and only instance of the ConsoleS...">Base::Console()</a> function to print the log. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.4-->
</div>
<!-- start footer part -->
<hr /><address class="footer"><small>
  Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
  </small></address>
</body>
</html>
